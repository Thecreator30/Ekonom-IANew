{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/laurent/Ekonom-IA%20%28App%29/Ekonom-IANew/backend/src/infrastructure/db.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\n\nconst globalForPrisma = global as unknown as { prisma: PrismaClient };\n\nexport const prisma = globalForPrisma.prisma || new PrismaClient();\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;\n\nexport default prisma;\n"],"names":[],"mappings":";;;;;;;;;;;;AAEA,MAAM;AAEC,MAAM,SAAS,gBAAgB,MAAM,IAAI,IAAI;AAEpD,wCAA2C,gBAAgB,MAAM,GAAG;uCAErD"}},
    {"offset": {"line": 72, "column": 0}, "map": {"version":3,"sources":["file:///Users/laurent/Ekonom-IA%20%28App%29/Ekonom-IANew/backend/src/utils/hash.ts"],"sourcesContent":["import bcrypt from 'bcryptjs';\n\nexport const hashPassword = async (password: string): Promise<string> => {\n    const salt = await bcrypt.genSalt(10);\n    return bcrypt.hash(password, salt);\n};\n\nexport const verifyPassword = async (password: string, hash: string): Promise<boolean> => {\n    return bcrypt.compare(password, hash);\n};\n"],"names":[],"mappings":";;;;;;AAAA;;AAEO,MAAM,eAAe,OAAO;IAC/B,MAAM,OAAO,MAAM,uMAAM,CAAC,OAAO,CAAC;IAClC,OAAO,uMAAM,CAAC,IAAI,CAAC,UAAU;AACjC;AAEO,MAAM,iBAAiB,OAAO,UAAkB;IACnD,OAAO,uMAAM,CAAC,OAAO,CAAC,UAAU;AACpC"}},
    {"offset": {"line": 109, "column": 0}, "map": {"version":3,"sources":["file:///Users/laurent/Ekonom-IA%20%28App%29/Ekonom-IANew/backend/src/utils/token.ts"],"sourcesContent":["import jwt from 'jsonwebtoken';\nimport { JWTPayload } from '../domain/auth';\n\nconst SECRET = process.env.JWT_SECRET || 'dev-secret';\n\nexport const signAccessToken = (payload: Omit<JWTPayload, 'iat' | 'exp'>): string => {\n    return jwt.sign(payload, SECRET, { expiresIn: '15m' });\n};\n\nexport const verifyToken = (token: string): JWTPayload => {\n    return jwt.verify(token, SECRET) as JWTPayload;\n};\n\nexport const verifyJwt = verifyToken;\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAGA,MAAM,SAAS,QAAQ,GAAG,CAAC,UAAU,IAAI;AAElC,MAAM,kBAAkB,CAAC;IAC5B,OAAO,2MAAG,CAAC,IAAI,CAAC,SAAS,QAAQ;QAAE,WAAW;IAAM;AACxD;AAEO,MAAM,cAAc,CAAC;IACxB,OAAO,2MAAG,CAAC,MAAM,CAAC,OAAO;AAC7B;AAEO,MAAM,YAAY"}},
    {"offset": {"line": 133, "column": 0}, "map": {"version":3,"sources":["file:///Users/laurent/Ekonom-IA%20%28App%29/Ekonom-IANew/backend/src/services/auth.service.ts"],"sourcesContent":["import { prisma } from '../infrastructure/db';\nimport { hashPassword, verifyPassword } from '../utils/hash';\nimport { signAccessToken } from '../utils/token';\nimport { User } from '../domain/auth';\nimport { randomBytes } from 'crypto';\n\nexport class AuthService {\n    static async register(data: { email: string; password: string; company_name: string }) {\n        const existing = await prisma.merchant.findUnique({ where: { email: data.email } });\n        if (existing) throw new Error('Email already registered');\n\n        const hashedPassword = await hashPassword(data.password);\n\n        const merchant = await prisma.merchant.create({\n            data: {\n                email: data.email,\n                password_hash: hashedPassword,\n                company_name: data.company_name,\n            },\n        });\n\n        return this.generateTokens(merchant);\n    }\n\n    static async login(data: { email: string; password: string }) {\n        const merchant = await prisma.merchant.findUnique({ where: { email: data.email } });\n        if (!merchant) throw new Error('Invalid credentials');\n\n        const isValid = await verifyPassword(data.password, merchant.password_hash);\n        if (!isValid) throw new Error('Invalid credentials');\n\n        return this.generateTokens(merchant);\n    }\n\n    private static async generateTokens(merchant: any) {\n        const user: User = {\n            id: merchant.id,\n            email: merchant.email,\n            role: 'MERCHANT',\n            merchant_id: merchant.id,\n        };\n\n        const accessToken = signAccessToken({ ...user, sub: merchant.id });\n\n        // Refresh Token (Rotation)\n        const refreshTokenString = randomBytes(40).toString('hex');\n        const expiresAt = new Date();\n        expiresAt.setDate(expiresAt.getDate() + 7); // 7 days\n\n        await prisma.refreshToken.create({\n            data: {\n                token_hash: refreshTokenString, // In prod, hash this too!\n                merchant_id: merchant.id,\n                expires_at: expiresAt,\n                revoked: false\n            }\n        });\n\n        return { user, accessToken, refreshToken: refreshTokenString };\n    }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AAEA;;;;;AAEO,MAAM;IACT,aAAa,SAAS,IAA+D,EAAE;QACnF,MAAM,WAAW,MAAM,gMAAM,CAAC,QAAQ,CAAC,UAAU,CAAC;YAAE,OAAO;gBAAE,OAAO,KAAK,KAAK;YAAC;QAAE;QACjF,IAAI,UAAU,MAAM,IAAI,MAAM;QAE9B,MAAM,iBAAiB,MAAM,IAAA,+LAAY,EAAC,KAAK,QAAQ;QAEvD,MAAM,WAAW,MAAM,gMAAM,CAAC,QAAQ,CAAC,MAAM,CAAC;YAC1C,MAAM;gBACF,OAAO,KAAK,KAAK;gBACjB,eAAe;gBACf,cAAc,KAAK,YAAY;YACnC;QACJ;QAEA,OAAO,IAAI,CAAC,cAAc,CAAC;IAC/B;IAEA,aAAa,MAAM,IAAyC,EAAE;QAC1D,MAAM,WAAW,MAAM,gMAAM,CAAC,QAAQ,CAAC,UAAU,CAAC;YAAE,OAAO;gBAAE,OAAO,KAAK,KAAK;YAAC;QAAE;QACjF,IAAI,CAAC,UAAU,MAAM,IAAI,MAAM;QAE/B,MAAM,UAAU,MAAM,IAAA,iMAAc,EAAC,KAAK,QAAQ,EAAE,SAAS,aAAa;QAC1E,IAAI,CAAC,SAAS,MAAM,IAAI,MAAM;QAE9B,OAAO,IAAI,CAAC,cAAc,CAAC;IAC/B;IAEA,aAAqB,eAAe,QAAa,EAAE;QAC/C,MAAM,OAAa;YACf,IAAI,SAAS,EAAE;YACf,OAAO,SAAS,KAAK;YACrB,MAAM;YACN,aAAa,SAAS,EAAE;QAC5B;QAEA,MAAM,cAAc,IAAA,mMAAe,EAAC;YAAE,GAAG,IAAI;YAAE,KAAK,SAAS,EAAE;QAAC;QAEhE,2BAA2B;QAC3B,MAAM,qBAAqB,IAAA,oHAAW,EAAC,IAAI,QAAQ,CAAC;QACpD,MAAM,YAAY,IAAI;QACtB,UAAU,OAAO,CAAC,UAAU,OAAO,KAAK,IAAI,SAAS;QAErD,MAAM,gMAAM,CAAC,YAAY,CAAC,MAAM,CAAC;YAC7B,MAAM;gBACF,YAAY;gBACZ,aAAa,SAAS,EAAE;gBACxB,YAAY;gBACZ,SAAS;YACb;QACJ;QAEA,OAAO;YAAE;YAAM;YAAa,cAAc;QAAmB;IACjE;AACJ"}},
    {"offset": {"line": 208, "column": 0}, "map": {"version":3,"sources":["file:///Users/laurent/Ekonom-IA%20%28App%29/Ekonom-IANew/backend/src/app/api/auth/login/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { AuthService } from '@/services/auth.service';\n\nexport async function POST(request: Request) {\n    try {\n        const body = await request.json();\n        const result = await AuthService.login(body);\n        return NextResponse.json(result);\n    } catch (error: any) {\n        return NextResponse.json({ error: error.message }, { status: 401 });\n    }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,KAAK,OAAgB;IACvC,IAAI;QACA,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,SAAS,MAAM,4MAAW,CAAC,KAAK,CAAC;QACvC,OAAO,yMAAY,CAAC,IAAI,CAAC;IAC7B,EAAE,OAAO,OAAY;QACjB,OAAO,yMAAY,CAAC,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACrE;AACJ"}}]
}